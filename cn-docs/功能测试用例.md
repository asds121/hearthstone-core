# 炉石传说功能测试用例

## 概述

本文档根据炉石传说的游戏机制，设计全面的功能测试用例，用于验证游戏实现的正确性。

---

## 1. 实体系统测试

### 1.1 实体创建与ID分配

**测试用例 TC001: 实体ID唯一性**
```
前置条件: 新游戏开始
测试步骤:
  1. 创建游戏实体
  2. 创建两个玩家实体
  3. 创建60张卡牌实体
  4. 创建英雄和英雄技能
  5. 创建幸运币
  
预期结果:
  ✓ 所有实体ID唯一
  ✓ ID分配顺序: 游戏(1) → 玩家1(2) → 玩家2(3) → 卡牌(4-63) → 英雄(64,66) → 英雄技能(65,67) → 幸运币(68)
```

**测试用例 TC002: 实体属性初始化**
```
前置条件: 游戏已初始化
测试步骤:
  1. 检查英雄属性
  2. 检查随从属性
  3. 检查法术属性
  4. 检查武器属性
  
预期结果:
  ✓ 英雄: 30生命值, 0攻击力, 0护甲
  ✓ 随从: 正确的攻击力、生命值、费用
  ✓ 法术: 正确的费用
  ✓ 武器: 正确的攻击力、耐久度
```

### 1.2 实体状态管理

**测试用例 TC003: 标签设置与获取**
```
前置条件: 游戏进行中
测试步骤:
  1. 设置实体标签
  2. 获取标签值
  3. 修改标签值
  4. 删除标签
  
预期结果:
  ✓ 标签正确设置
  ✓ 标签值正确获取
  ✓ 标签值正确修改
  ✓ 标签正确删除
```

**测试用例 TC004: 实体比较**
```
前置条件: 游戏进行中
测试步骤:
  1. 创建两个相同类型的实体
  2. 比较实体ID
  3. 修改一个实体的属性
  4. 再次比较
  
预期结果:
  ✓ 实体ID不同
  ✓ 即使属性相同，实体也不同
  ✓ 修改属性不影响实体标识
```

---

## 2. 区域系统测试

### 2.1 区域移动

**测试用例 TC005: 基本区域移动**
```
前置条件: 游戏进行中
测试步骤:
  1. 从牌库抽牌到手牌
  2. 从手牌使用卡牌到战场
  3. 随从死亡移动到墓地
  4. 使用法术进入墓地
  
预期结果:
  ✓ 牌库 → 手牌: 卡牌正确移动
  ✓ 手牌 → 战场: 卡牌正确移动
  ✓ 战场 → 墓地: 卡牌正确移动
  ✓ 手牌 → 墓地: 法术卡牌正确移动
```

**测试用例 TC006: 满区域处理**
```
前置条件: 战场有7个随从，手牌有10张牌
测试步骤:
  1. 尝试召唤第8个随从
  2. 尝试抽第11张牌
  3. 尝试将第8个随从加入手牌
  
预期结果:
  ✓ 满场时召唤随从: 随从被消灭
  ✓ 满手牌时抽牌: 卡牌被烧毁
  ✓ 满手牌时获得卡牌: 卡牌被烧毁
```

**测试用例 TC007: 区域位置管理**
```
前置条件: 游戏进行中
测试步骤:
  1. 检查手牌位置
  2. 检查战场随从位置
  3. 检查墓地卡牌位置
  4. 移动卡牌后检查位置
  
预期结果:
  ✓ 手牌有正确的位置值 (1-10)
  ✓ 战场随从有正确的位置值 (1-7)
  ✓ 墓地卡牌位置为0
  ✓ 移动后位置正确更新
```

### 2.2 伪区域移动

**测试用例 TC008: 亡语区域移动**
```
前置条件: 游戏进行中
测试步骤:
  1. 使用具有回手亡语的随从
  2. 随从死亡触发亡语
  3. 检查随从位置
  4. 验证瑞文戴尔男爵效果
  
预期结果:
  ✓ 亡语触发后随从移动到指定区域
  ✓ 原实体被移除，创建新实体
  ✓ 瑞文戴尔男爵不触发伪区域移动
  ✓ 入场时间点保留
```

---

## 3. 事件系统测试

### 3.1 基础事件处理

**测试用例 TC009: 事件触发与响应**
```
前置条件: 战场有飞刀杂耍者
测试步骤:
  1. 召唤一个随从
  2. 观察飞刀杂耍者触发
  3. 检查伤害目标
  4. 重复召唤多个随从
  
预期结果:
  ✓ 每次召唤后飞刀杂耍者触发
  ✓ 伤害随机敌方角色
  ✓ 伤害值为1
  ✓ 多次召唤多次触发
```

**测试用例 TC010: 事件嵌套处理**
```
前置条件: 战场有北郡牧师和苦痛侍僧
测试步骤:
  1. 对苦痛侍僧造成伤害
  2. 观察事件链
  3. 检查抽牌数量
  4. 验证事件顺序
  
预期结果:
  ✓ 苦痛侍僧受伤触发抽牌
  ✓ 北郡牧师响应治疗事件抽牌
  ✓ 事件按正确顺序处理
  ✓ 无无限循环
```

### 3.2 扳机排序

**测试用例 TC011: 入场顺序扳机**
```
前置条件: 按顺序入场：飞刀杂耍者、卡德加、公正之剑
测试步骤:
  1. 召唤一个随从
  2. 观察触发顺序
  3. 检查每个扳机的效果
  
预期结果:
  ✓ 飞刀杂耍者最先触发
  ✓ 卡德加其次触发
  ✓ 公正之剑最后触发
  ✓ 触发顺序符合入场顺序
```

**测试用例 TC012: 区域顺序扳机**
```
前置条件: 场上有艇长，手牌有空降歹徒，牌库有帕奇斯
测试步骤:
  1. 使用南海船工
  2. 观察触发顺序
  3. 检查每个扳机是否触发
  
预期结果:
  ✓ 艇长（场上）最先触发
  ✓ 空降歹徒（手牌）其次触发
  ✓ 帕奇斯（牌库）最后触发
  ✓ 符合场上→手牌→牌库顺序
```

**测试用例 TC013: 特殊优先级扳机**
```
前置条件: 战场有救赎和自爆绵羊
测试步骤:
  1. 杀死自爆绵羊
  2. 观察触发顺序
  3. 验证救赎效果
  
预期结果:
  ✓ 自爆绵羊亡语先触发
  ✓ 救赎后触发
  ✓ 自爆绵羊被救赎召唤回来
  ✓ 符合救赎低优先级规则
```

---

## 4. 序列系统测试

### 4.1 卡牌使用序列

**测试用例 TC014: 随从使用序列**
```
前置条件: 手牌有随从牌
测试步骤:
  1. 使用随从牌
  2. 观察使用阶段扳机
  3. 观察结算阶段效果
  4. 观察完成阶段扳机
  
预期结果:
  ✓ 支付正确费用
  ✓ 使用时扳机触发
  ✓ 战吼正确结算
  ✓ 召唤后扳机触发
  ✓ 使用后扳机触发
```

**测试用例 TC015: 法术使用序列**
```
前置条件: 手牌有法术牌
测试步骤:
  1. 使用法术牌
  2. 观察法术反制
  3. 检查法术效果
  4. 观察狂野炎术师触发
  
预期结果:
  ✓ 费用正确扣除
  ✓ 法术反制可反制法术
  ✓ 法术效果正确结算
  ✓ 使用后扳机触发
```

**测试用例 TC016: 武器使用序列**
```
前置条件: 手牌有武器牌，已装备武器
测试步骤:
  1. 使用新武器
  2. 观察旧武器销毁
  3. 检查新武器装备
  4. 验证战吼效果
  
预期结果:
  ✓ 旧武器被销毁
  ✓ 新武器正确装备
  ✓ 战吼效果触发
  ✓ 武器攻击力正确应用
```

### 4.2 战斗序列

**测试用例 TC017: 基础战斗流程**
```
前置条件: 有可攻击的随从
测试步骤:
  1. 选择攻击者和防御者
  2. 执行攻击
  3. 检查伤害值
  4. 验证攻击次数增加
  
预期结果:
  ✓ 攻击者和防御者同时造成伤害
  ✓ 伤害值等于各自攻击力
  ✓ 攻击次数正确增加
  ✓ 潜行状态被移除
```

**测试用例 TC018: 攻击前扳机**
```
前置条件: 对手有爆炸陷阱
测试步骤:
  1. 英雄攻击对手英雄
  2. 观察爆炸陷阱触发
  3. 检查伤害
  4. 验证攻击是否继续
  
预期结果:
  ✓ 爆炸陷阱在伤害阶段前触发
  ✓ 对攻击者造成2点伤害
  ✓ 攻击正常进行
  ✓ 伤害正确结算
```

**测试用例 TC019: 防御者改变**
```
前置条件: 对手有误导和毒蛇陷阱
测试步骤:
  1. 随从攻击对手英雄
  2. 误导触发改变防御者
  3. 观察毒蛇陷阱触发
  
预期结果:
  ✓ 误导触发改变防御者
  ✓ 重新执行攻击前阶段
  ✓ 毒蛇陷阱对新防御者触发
  ✓ 攻击正常完成
```

**测试用例 TC020: 战斗伤害事件**
```
前置条件: 两个暴乱狂战士互相攻击
测试步骤:
  1. 暴乱狂战士A攻击暴乱狂战士B
  2. 观察伤害事件
  3. 检查攻击力变化
  4. 验证事件顺序
  
预期结果:
  ✓ 双方同时造成伤害
  ✓ 伤害事件在伤害后触发
  ✓ 双方攻击力都增加
  ✓ 事件按入场顺序处理
```

---

## 5. 死亡系统测试

### 5.1 死亡检索

**测试用例 TC021: 基础死亡流程**
```
前置条件: 战场有随从
测试步骤:
  1. 将随从生命值降至0
  2. 观察死亡检索
  3. 检查随从位置
  4. 验证死亡事件
  
预期结果:
  ✓ 濒死随从被标记
  ✓ 死亡时扳机触发
  ✓ 随从移动到墓地
  ✓ 死亡阶段正确执行
```

**测试用例 TC022: 死亡顺序**
```
前置条件: 多个随从同时死亡
测试步骤:
  1. 使用AOE法术杀死多个随从
  2. 观察死亡顺序
  3. 检查亡语触发顺序
  4. 验证入场顺序影响
  
预期结果:
  ✓ 按入场顺序移除实体
  ✓ 亡语按入场顺序触发
  ✓ 先入场随从亡语先触发
  ✓ 死亡事件正确排序
```

**测试用例 TC023: 死亡时扳机**
```
前置条件: 战场有火焰狂人和濒死随从
测试步骤:
  1. 触发死亡检索
  2. 火焰狂人抽牌
  3. 抽到惊奇卡牌
  4. 观察嵌套死亡检索
  
预期结果:
  ✓ 火焰狂人在死亡时扳机阶段抽牌
  ✓ 惊奇卡牌触发强制死亡
  ✓ 产生嵌套死亡检索
  ✓ 正确处理嵌套死亡
```

### 5.2 死亡阶段

**测试用例 TC024: 死亡阶段连锁**
```
前置条件: 自爆绵羊和机械克苏恩在场
测试步骤:
  1. 杀死自爆绵羊A
  2. 观察死亡阶段I
  3. 观察死亡检索II
  4. 检查连锁反应
  
预期结果:
  ✓ 自爆绵羊A死亡触发亡语
  ✓ 自爆绵羊B和克苏恩受到伤害
  ✓ 死亡阶段II处理新死亡
  ✓ 克苏恩亡语消灭对手英雄
```

---

## 6. 光环系统测试

### 6.1 基础光环

**测试用例 TC025: 属性光环**
```
前置条件: 战场有暴风城勇士和小精灵
测试步骤:
  1. 检查小精灵初始属性
  2. 暴风城勇士入场
  3. 观察光环更新
  4. 检查小精灵新属性
  
预期结果:
  ✓ 小精灵初始为1/1
  ✓ 暴风城勇士入场触发光环更新
  ✓ 小精灵变为2/2
  ✓ 光环效果正确应用
```

**测试用例 TC026: 光环优先级**
```
前置条件: 先使用黑暗裁决，再使用暴风城勇士
测试步骤:
  1. 对小精灵使用黑暗裁决
  2. 使用暴风城勇士
  3. 检查小精灵属性
  4. 验证优先级
  
预期结果:
  ✓ 黑暗裁决使小精灵变为3/3
  ✓ 暴风城勇士光环使其变为4/4
  ✓ 光环优先级低于状态
  ✓ 最终属性计算正确
```

**测试用例 TC027: 光环更新时机**
```
前置条件: 战场有玛尔加尼斯
测试步骤:
  1. 英雄受到伤害
  2. 玛尔加尼斯被沉默
  3. 观察光环失效
  4. 英雄再次受到伤害
  
预期结果:
  ✓ 玛尔加尼斯在场时英雄免疫
  ✓ 沉默后光环立即失效
  ✓ 英雄受到正常伤害
  ✓ 光环更新时机正确
```

### 6.2 特殊光环

**测试用例 TC028: 费用光环**
```
前置条件: 手牌有被大帝减费的大哥，再使用艾维娜
测试步骤:
  1. 索瑞森大帝减费摩天龙
  2. 使用艾维娜
  3. 检查摩天龙费用
  4. 验证光环和状态顺序
  
预期结果:
  ✓ 摩天龙被减为0费
  ✓ 艾维娜使其变为1费
  ✓ 费用光环和状态按顺序结算
  ✓ 最终费用计算正确
```

**测试用例 TC029: 触发器光环**
```
前置条件: 使用布莱恩·铜须
测试步骤:
  1. 使用战吼随从
  2. 观察战吼触发次数
  3. 验证光环效果
  4. 检查战吼期间离场
  
预期结果:
  ✓ 战吼触发两次
  ✓ 光环在战吼前确定次数
  ✓ 战吼期间离场不影响次数
  ✓ 光环效果正确应用
```

---

## 7. 特殊机制测试

### 7.1 变形与复制

**测试用例 TC030: 随从变形**
```
前置条件: 战场有随从
测试步骤:
  1. 对随从使用变形术
  2. 观察变形效果
  3. 检查原随从状态
  4. 验证变形不是死亡
  
预期结果:
  ✓ 随从变为指定形态
  ✓ 原随从被移除
  ✓ 不触发死亡扳机
  ✓ 新随从保留原ID
```

**测试用例 TC031: 无面操纵者复制**
```
前置条件: 对手有暴风城勇士和血沼迅猛龙
测试步骤:
  1. 使用无面操纵者复制迅猛龙
  2. 观察复制属性
  3. 检查光环效果
  4. 验证复制规则
  
预期结果:
  ✓ 复制体为0/1（不含光环）
  ✓ 复制体立即死亡
  ✓ 光环效果不复制
  ✓ 复制遵循复制规则
```

**测试用例 TC032: 变形与战吼**
```
前置条件: 使用变形药水
测试步骤:
  1. 对手使用血沼迅猛龙
  2. 变形药水触发
  3. 观察变形顺序
  4. 检查召唤效果
  
预期结果:
  ✓ 变形药水先触发
  ✓ 血沼迅猛龙变为绵羊
  ✓ 召唤效果召唤变形后的随从
  ✓ 符合变形优先规则
```

### 7.2 休眠机制

**测试用例 TC033: 随从休眠**
```
前置条件: 使用玛维·影歌
测试步骤:
  1. 使随从休眠
  2. 观察休眠状态
  3. 等待苏醒
  4. 检查苏醒后状态
  
预期结果:
  ✓ 随从进入休眠状态
  ✓ 保留所有状态
  ✓ 苏醒时有召唤失调
  ✓ 入场时间点保留
```

### 7.3 控制权转移

**测试用例 TC034: 精神控制**
```
前置条件: 场上有可控制的随从
测试步骤:
  1. 使用精神控制
  2. 观察控制权转移
  3. 检查随从位置
  4. 验证入场时间点
  
预期结果:
  ✓ 随从控制权转移
  ✓ 随从移动到正确位置
  ✓ 入场时间点不变
  ✓ 召唤失调正确应用
```

---

## 8. 复杂交互测试

### 8.1 连锁效果

**测试用例 TC035: 尤格-萨隆连锁**
```
前置条件: 本局使用10个法术
测试步骤:
  1. 使用尤格-萨隆
  2. 观察连锁效果
  3. 检查每个法术
  4. 验证过载获得
  
预期结果:
  ✓ 触发10个随机法术
  ✓ 每个法术获得过载
  ✓ 法术享受法术伤害
  ✓ 连锁正确结束
```

### 8.2 胜利条件

**测试用例 TC036: 胜负判定**
```
前置条件: 英雄生命值降至0
测试步骤:
  1. 英雄受到伤害
  2. 观察胜负裁定
  3. 检查游戏状态
  4. 验证序列完成
  
预期结果:
  ✓ 英雄濒死被标记
  ✓ 死亡检索设置LOSING状态
  ✓ 胜负裁定结束游戏
  ✓ 当前序列完成执行
```

**测试用例 TC037: 平局条件**
```
前置条件: 双方英雄同时死亡
测试步骤:
  1. 触发同时死亡效果
  2. 观察胜负裁定
  3. 检查游戏结果
  4. 验证平局处理
  
预期结果:
  ✓ 双方都被设置LOSING
  ✓ 游戏判定为平局
  ✓ 双方英雄爆炸
  ✓ 天梯星数不减少
```

---

## 9. 边界条件测试

### 9.1 数值边界

**测试用例 TC038: 攻击力溢出**
```
前置条件: 随从攻击力达到上限
测试步骤:
  1. 将随从攻击力提升至2^31-1
  2. 继续增加攻击力
  3. 观察数值变化
  4. 检查游戏稳定性
  
预期结果:
  ✓ 攻击力达到上限
  ✓ 继续增加不生效
  ✓ 数值不会变为负数
  ✓ 游戏不会崩溃
```

**测试用例 TC039: 生命值上限**
```
前置条件: 英雄生命值达到上限
测试步骤:
  1. 使用希望守护者阿玛拉
  2. 观察生命值变化
  3. 尝试超过上限
  4. 验证上限限制
  
预期结果:
  ✓ 生命值设置为40
  ✓ 不会超过上限
  ✓ 生命值上限正确更新
  ✓ 伤害正常计算
```

### 9.2 递归深度

**测试用例 TC040: 嵌套死亡检索**
```
前置条件: 设置深度嵌套死亡场景
测试步骤:
  1. 创建多层死亡检索
  2. 观察处理过程
  3. 检查递归深度
  4. 验证系统稳定性
  
预期结果:
  ✓ 正确处理嵌套死亡
  ✓ 递归深度有限制
  ✓ 不会栈溢出
  ✓ 所有死亡正确处理
```

---

## 10. 性能测试

### 10.1 批量处理

**测试用例 TC041: AOE效果性能**
```
前置条件: 战场有7个暴乱狂战士
测试步骤:
  1. 使用烈焰风暴
  2. 记录处理时间
  3. 检查触发次数
  4. 验证性能指标
  
预期结果:
  ✓ 处理时间 < 100ms
  ✓ 触发49次扳机
  ✓ 无性能瓶颈
  ✓ 内存使用正常
```

### 10.2 光环更新

**测试用例 TC042: 光环批量更新**
```
前置条件: 战场有多个光环源
测试步骤:
  1. 同时触发多个光环更新
  2. 观察更新过程
  3. 检查更新时间
  4. 验证增量更新
  
预期结果:
  ✓ 光环正确更新
  ✓ 只更新受影响的实体
  ✓ 更新时间合理
  ✓ 无重复计算
```

---

## 测试执行计划

### 阶段1: 核心系统测试 (TC001-TC015)
- 实体系统验证
- 基础区域移动
- 事件和扳机基础
- 序列系统基础

### 阶段2: 高级机制测试 (TC016-TC030)
- 复杂序列处理
- 死亡系统
- 光环系统基础
- 变形和复制

### 阶段3: 边界条件测试 (TC031-TC040)
- 特殊交互
- 数值边界
- 递归深度
- 异常情况

### 阶段4: 性能测试 (TC041-TC042)
- 批量处理性能
- 光环更新性能
- 压力测试
- 内存使用

---

## 测试工具

### 自动化测试框架
```typescript
class TestRunner {
    async runTest(testCase: TestCase): Promise<TestResult> {
        try {
            // 设置测试环境
            const game = this.setupTestEnvironment(testCase.setup);
            
            // 执行测试步骤
            for (const step of testCase.steps) {
                await this.executeStep(game, step);
            }
            
            // 验证结果
            const result = this.verifyResults(game, testCase.expectations);
            
            return {
                id: testCase.id,
                name: testCase.name,
                passed: result.passed,
                details: result.details
            };
        } catch (error) {
            return {
                id: testCase.id,
                name: testCase.name,
                passed: false,
                error: error.message
            };
        }
    }
}
```

---

## 总结

本测试用例集涵盖了炉石传说的核心机制，包括：

1. **实体系统**: ID分配、状态管理
2. **区域系统**: 移动规则、满区域处理
3. **事件系统**: 事件触发、扳机排序
4. **序列系统**: 卡牌使用、战斗流程
5. **死亡系统**: 死亡检索、死亡阶段
6. **光环系统**: 属性修改、触发器增强
7. **特殊机制**: 变形、复制、休眠
8. **边界条件**: 数值溢出、递归深度
9. **性能测试**: 批量处理、光环更新

通过执行这些测试用例，可以全面验证游戏实现的正确性和稳定性。
